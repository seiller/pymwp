<select id="demo-options" aria-label="demo options"></select>

<pre id="demo-display" style="white-space: break-spaces;">
    Choose an example to analyze
</pre>

<script>
    const base = "https://pymwp1.uk.r.appspot.com/";
    const displayPre = document.getElementById('demo-display');
    const select = document.getElementById('demo-options');
    const examples = {
        "Basic Examples": {
            "assign expression": "basics/assign_expression.c",
            "assign value": "basics/assign_value.c",
            "assign variable": "basics/assign_variable.c",
            "declaration": "basics/declaration",
            "empty": "basics/empty.c",
            "empty main": "basics/empty_main.c",
            "if": "basics/if.c",
            "if else": "basics/if_else.c",
            "while 1": "basics/while_1.c",
            "while 2": "basics/while_2.c",
            "while if": "basics/while_if.c",
        },
        "Infinite": {
            "exponent": "infinite/exponent.c",
            "infinite, 2 variables": "infinite/infinite_2.c",
            "infinite, 3 variables": "infinite/infinite_3.c",
            "infinite, 4 variables": "infinite/infinite_4.c",
            "infinite, 5 variables": "infinite/infinite_5.c",
            "infinite, 6 variables": "infinite/infinite_6.c",
            "infinite, 7 variables": "infinite/infinite_7.c",
            "infinite, 8 variables": "infinite/infinite_8.c",
        },
        "Not infinite": {
            "not infinite, 2 variables": "not_infinite/notinfinite_2.c",
            "not infinite, 3 variables": "not_infinite/notinfinite_3.c",
            "not infinite, 4 variables": "not_infinite/notinfinite_4.c",
            "not infinite, 5 variables": "not_infinite/notinfinite_5.c",
            "not infinite, 6 variables": "not_infinite/notinfinite_6.c",
            "not infinite, 7 variables": "not_infinite/notinfinite_7.c",
            "not infinite, 8 variables": "not_infinite/notinfinite_8.c",
        },
        "Other": {
            "braces issue": "other/braces_issue.c",
            "dense": "other/dense.c",
            "function (alone)": "other/f_alone.c",
            "function (inline)": "other/f_inline.c",
            "main without function": "other/f_main.c",
            "for body": "other/for_body.c",
            "for, not body": "other/for_not_body.c",
        }
    }

    function display(text) {
        displayPre.innerText = text;
    }

    function loadOptions() {
        return Object.entries(examples).map(function ([category, options], i) {
            const displayOptions = Object.entries(options).map(function ([label, path]) {
                return `<option value="${path}">${label}</option>`
            }).join('');

            return `<option disabled ${i === 0 ? "selected" : ""}>${category}</option>${displayOptions}`
        }).join('');
    }

    function analyze(event) {
        const path = event.target.value;
        const xhr = new window.XMLHttpRequest();
        const onError = () => display("Sorry, demo unavailable! Try again later.");
        xhr.open('GET', `${base}${path}`, true);
        xhr.onload = _ => {
            if (xhr.readyState === 4) {
                display(xhr.responseText)
            }
        }
        xhr.onerror = onError;
        xhr.send();
    }

    select.innerHTML = loadOptions();
    select.onchange = analyze;
</script>

